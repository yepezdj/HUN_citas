<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- ===== BOX ICONS ===== -->
    <link href='https://cdn.jsdelivr.net/npm/boxicons@2.0.5/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css"
        integrity="sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ" crossorigin="anonymous">


    <!-- ===== CSS ===== -->
    <link rel="stylesheet" href="/css/styleExportar.css">

    <!-- ===== BOOTSTRAP ===== -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <!-- ===== DATA TABLES ===== -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.2/css/bootstrap.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.24/css/dataTables.bootstrap4.min.css">
    <link rel="stylesheet" type="text/css"
        href="https://cdn.datatables.net/buttons/1.7.0/css/buttons.bootstrap4.min.css" />
    <!-- ===== JQUERY ===== -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>


    <title>Conciliador</title>
</head>

<body id="body-pd">
    <header class="header" id="header">
        <div class="header__toggle">
            <i class='bx bx-menu' id="header-toggle"></i>
        </div>

        <div class="header__img">
            <img src="/images/HUN.jpg" alt="">
        </div>

    </header>

    <div class="l-navbar" id="nav-bar">
        <nav class="nav">
            <div>
                <a href="https://www.uninorte.edu.co/web/hospital" class="nav__logo">
                    <i class="bi bi-house nav__logo-icon"></i> 
                    <span class="nav__logo-name">
                        Hospital<br>
                        Universidad del<br>
                        Norte
                    </span>
                </a>

                <div class="nav__list">
                    <a href="/conciliator/conciliatormain" class="nav__link">
                        <i class="bi bi-clipboard nav__icon"></i>
                        <span class="nav__name">Solicitud de citas</span>
                    </a>
                </div>
                <div class="nav__list">
                    <a href="/conciliator/Appoitments" class="nav__link">
                        <i class="bi bi-clipboard-check nav__icon"></i>
                        <span class="nav__name">Citas aceptadas</span>
                    </a>
                </div>
            </div>
            <a href="#" onclick="logOut()" class="nav__link">
                <i class='bx bx-log-out nav__icon'></i>
                <span class="nav__name">Cerrar sesión</span>
            </a>
        </nav>
    </div>

    <div class="container-fluid">

        <div class="col-md-12" style="margin-top: 80px;">
            <h4 class="title text-center mt-4">
                Hola <%=user.name%>
            </h4>
            <hr class="my-4">
            <div class="text-center mb-2">
                A continuación podrás exportar las citas médicas reservadas hasta la fecha
            </div>
            <table id="conTable" class="table table-bordered table-responsive">
                <thead>
                    <tr>
                        <th class='notexport'>AGENDADA</th>
                        <th>SEDE</th>
                        <th>AÑO_CITA</th>
                        <th>MES_CITA</th>
                        <th>ESTADO_CITA</th>
                        <th>FACTURA</th>
                        <th>VALOR_FACTURA</th>
                        <th>NUMERO_CITA</th>
                        <th>NRO_INGRESO</th>
                        <th>ID_PACIENTE</th>
                        <th>TIPO_ID</th>
                        <th>NOMBRE_PACIENTE</th>
                        <th>SEXO</th>
                        <th>FECHA_NACIMIENTO</th>
                        <th>EDAD_ATENCION</th>
                        <th>DIRECCION</th>
                        <th>TELEFONO</th>
                        <th>ID_CONTRATO_CITA</th>
                        <th>DESCRIPCION_CONTRATO_CITA</th>
                        <th>ID_CONTRATO_FACTURA</th>
                        <th>DESCRIPCION_CONTRATO_CITA</th>
                        <th>NIT_TERCERO</th>
                        <th>RAZON_SOCIAL</th>
                        <th>CONSULTORIO</th>
                        <th>ID_MEDICO</th>
                        <th>NOMBRE_MEDICO</th>
                        <th>ESPECIALIDAD</th>
                        <th>FECHA_ASIGNACION</th>
                        <th>NRO_DIAS_OPORTUNIDAD</th>
                        <th>FECHA_SOL_PACIENTE</th>
                        <th>NRO_DIAS_ASIGNACION</th>
                        <th>FOLIO</th>
                        <th>CODIGO_DIAGNOSTICO</th>
                        <th>DESCRIPCION DIAGNOSTICO</th>
                        <th>ID_PROCEDIMIENTO</th>
                        <th>NOMBRE_PROCEDIMIENTO</th>
                        <th>FECHA_RESERVA_CITA</th>
                        <th>FECHA_CITA</th>
                        <th>FECHA_CONFIRMA_CITA</th>
                        <th>FECHA_FACTURADA_CITA</th>
                        <th>FECHA_ATENCION_CITA</th>
                        <th>CODIGO_USR</th>
                        <th>CODIGO_USR2</th>
                        <th>USUARIO_ASIGNA_CITA</th>
                        <th>PRIMER_NOMBRE</th>
                        <th>SEGUNDO_NOMBRE</th>
                        <th>PRIMER_APELLIDO</th>
                        <th>SEGUNDO_APELLIDO</th>
                        <th>NOMBRE_AUTORIZA</th>
                    </tr>
                </thead>
                <tbody id="tabla">

                    <tr>
                        <% if (info) { %>
                            <!-- Es el nombre que se le dió a los datos obtenidos en el controller.list -->

                            <% for(var i=0; i < info.length; i++) { %>

                                <td>

                                    <a onclick="valor('<%= info[i].idpa %>')" class="btn btn-primary"><i class="fas fa-calendar"></i></a>

                                </td>
                                <td>
                                    Sede principal hospital
                                </td>
                                <td>
                                    <%= info[i].año %>
                                </td>
                                <td>
                                    <% switch (info[i].mes) { case 'January' : %>
                                        Enero
                                        <% break; case 'February' : %>
                                            Febrero
                                            <% break; case 'March' : %>
                                                Marzo
                                                <% break; case 'April' : %>
                                                    Abril
                                                    <% break; case 'May' : %>
                                                        Mayo
                                                        <% break; case 'June' : %>
                                                            Junio
                                                            <% break; case 'July' : %>
                                                                Julio
                                                                <% break; case 'August' : %>
                                                                    Agosto
                                                                    <% break; case 'September' : %>
                                                                        Septiembre
                                                                        <% break; case 'October' : %>
                                                                            Octubre
                                                                            <% break; case 'November' : %>
                                                                                Noviembre
                                                                                <% break; case 'December' : %>
                                                                                    Diciembre
                                                                                    <% break; } %>

                                </td>
                                <td>
                                    Reservado
                                </td>
                                <td>

                                </td>
                                <td>

                                </td>
                                <td>

                                </td>
                                <td>

                                </td>
                                <td>
                                    <%= info[i].idu %>
                                </td>
                                <td>
                                    <%= info[i].Tipo_documento %>
                                </td>
                                <td>
                                    <%= info[i].NombreP %>
                                        <%= info[i].ApellidoP %>
                                </td>
                                <td>
                                    <%= info[i].sexo %>
                                </td>
                                <td>
                                    <%= info[i].fecha_nac %>
                                </td>
                                <td>

                                </td>
                                <td>
                                    <%= info[i].Direccion %>
                                        <%= info[i].Barrio %>
                                </td>
                                <td>
                                    <%= info[i].Celular %>
                                </td>
                                <td>

                                </td>
                                <td>

                                </td>
                                <td>

                                </td>
                                <td>

                                </td>
                                <td>

                                </td>
                                <td>

                                </td>
                                <td>

                                </td>
                                <td>

                                </td>
                                <td>
                                    <%= info[i].Doctor %>
                                </td>
                                <td>
                                    <%= info[i].Especialidad %>
                                </td>
                                <td>
                                    <%= info[i].fecha %>
                                </td>
                                <td>

                                </td>
                                <td>
                                    <%= info[i].hora_solicitud %>
                                </td>
                                <td>

                                </td>
                                <td>

                                </td>
                                <td>

                                </td>
                                <td>

                                </td>
                                <td>

                                </td>
                                <td>
                                    <%= info[i].Cita %>
                                </td>
                                <td>
                                    <%= info[i].hora_solicitud %>
                                </td>
                                <td>
                                    <%= info[i].fecha %>
                                </td>
                                <td>

                                </td>
                                <td>

                                </td>
                                <td>
                                    <%= info[i].fecha %>
                                </td>
                                <td>

                                </td>
                                <td>

                                </td>
                                <td>
                                    <%= user.name %>
                                        <%= user.last_name %>
                                </td>
                                <td>
                                    <%= info[i].NombreP %>
                                </td>
                                <td>

                                </td>
                                <td>
                                    <%= info[i].ApellidoP %>
                                </td>
                                <td>

                                </td>
                                <td>

                                </td>
                    </tr>
                    <% } %>
                        <% } %>
                </tbody>

            </table>

        </div>
    </div>

    <!--===== MAIN JS =====-->
    <script src="/js/main.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <script src="https://cdn.datatables.net/1.10.24/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.24/js/dataTables.bootstrap4.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.2.7/js/dataTables.responsive.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.2.7/js/responsive.bootstrap4.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/buttons/1.7.0/js/dataTables.buttons.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/buttons/1.7.0/js/buttons.bootstrap4.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.5.1/js/dataTables.buttons.min.js"></script>

    <script src="https://cdn.datatables.net/buttons/1.5.1/js/buttons.flash.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.32/pdfmake.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.32/vfs_fonts.js"></script>

    <script src="https://cdn.datatables.net/buttons/1.5.1/js/buttons.html5.min.js"></script>

    <script src="https://cdn.datatables.net/buttons/1.5.1/js/buttons.print.min.js"></script>
    <script>
        $(document).ready(function () {
            var $table = $('#conTable').DataTable({
                // "scrollX": true,              
                language: {
                    processing: "Búsqueda en curso...",
                    search: "Buscar:",
                    lengthMenu: "Mostrar _MENU_ registros",
                    info: "Página _PAGE_ de _PAGES_",
                    infoEmpty: "No hay registros disponibles",
                    infoFiltered: "(filtrado de _MAX_ elementos)",
                    zeroRecords: "No hay registros con este criterio de búsqueda",
                    infoPostFix: "",
                    loadingRecords: "Cargando...",
                    emptyTable: "La tabla aún no contiene registros",
                    paginate: {
                        first: "Primero",
                        previous: "Anterior",
                        next: "Siguiente",
                        last: "último"
                    },
                    aria: {
                        sortAscending: ": Ordenar de forma ascendente",
                        sortDescending: ": Ordenar de forma descendente"
                    }
                },
                // responsive: "true",
                dom: 'Bfrtip',
                buttons: [
                    // 'excelHtml5'
                    {
                        extend: 'excel',
                        text: '<i class="fas fa-file-excel"></i>',
                        titleAttr: 'Exportar información a excel',
                        className: 'btn btn-success',
                        exportOptions: {
                            columns: ':visible:not(.notexport)'
                        }
                    }
                ]
            });

        });

        function valor(id) {
            let data = {
                id: id
            }
            if (!data) {
                console.log('error')
            } else {
                AgregarValor(data);
            }
        }



        function AgregarValor(data) {
            $.ajax({
                type: 'POST',
                url: '/updateExport',
                data: data,
                success: function (msg) {

                    console.log('good job');
                    
                    table.ajax.reload();
                    
                    table.draw();
                    // Swal.fire(
                    //     '¡Buen trabajo!',
                    //     '¡Se han enviado correctamente los datos!',
                    //     'success'
                    // ).then(function () {
                    //     window.location = "/admin/adminmain";
                    // });
                },
                error: function (error) {
                    Swal.fire({
                        icon: 'error',
                        title: 'Oops...',
                        text: 'Hubo un error'
                    })
                }
            });
        }
    </script>

</body>

</html>